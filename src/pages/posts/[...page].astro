---
import { format } from "date-fns"
import Head from '@components/Head.astro'
import Header from '@components/Header.astro'
import Footer from '@components/Footer.astro'

let title = 'Posts'
let description = 'Posts on brycewray.com'

export async function getStaticPaths({ paginate, rss }) {
  let allPosts = await Astro.glob('../posts/**/*.md')
  let sortedPosts = allPosts.sort((a, b) =>
    new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf()
  )
  rss({
    title: "BryceWray.com",
    description: "brycewray.com â€” Observations, opinions, geekery.",
    customData: `<language>en-us</language>`,
    items: sortedPosts.map(post => ({
      title: post.frontmatter.title,
      stylesheet: true,
      description: post.frontmatter.description,
      link: post.url,
      pubDate: post.frontmatter.date
    })),
    dest: "/index.xml",
  })
  return [
    paginate(sortedPosts, {
      pageSize: 5
    }),
  ]
}

const { page } = Astro.props

---

<html lang="en">

  <head>
    <Head
      {title}
      {description}
    />
  </head>

  <body>
    <Header />
    <main>
      <div class="container ctr sansSerif">
        <h1 class="posts-Head">Posts</h1>
        <div class="posts-Container">
          <div class="pagerThingP">
            {page.url.prev == null
              ? <div class="page1">&#9664;&#9664;</div>
              : <div class="page1"><a href="/posts/">&#9664;&#9664;</a></div>
            }
            {page.url.prev
              ? <div class="pageP"><a href={page.url.prev}>&#9664;</a></div>
              : <div class="pageP">&#9664;</div>
            }
            {page.url.next
              ? <div class="pageN"><a href={page.url.next}>&#9654;</a></div>
              : <div class="pageN">&#9654;</div>
            }
            {page.url.next == null
              ? <div class="pageL">&#9654;&#9654;</div>
              : <div class="pageL"><a href=`/posts/${page.lastPage}/`>&#9654;&#9654;</a></div>
            }
          </div>
          <hr class="paginatorTop" />
          <div class="posts-ItemDiv">
            {page.data.map(post =>
              <h2 class="posts-Title"><a href=`${post.url}/`>{post.frontmatter.title}</a></h2>
              <p class="posts-Description">
                {post.frontmatter.description}
              </p>
              <p class="posts-Dates"><strong>{format(new Date(post.frontmatter.date), "MMMM d, yyyy")}</strong>
                {post.frontmatter.lastmod && (
                  <br /><span class="eightyFive">Last modified {format(new Date(post.frontmatter.lastmod), "MMMM d, yyyy")}</span>
                )}
              </p>
            )}
          </div>
          <hr class="paginatorBottom" />
          <div class="pagerThingP">
            {page.url.prev == null
              ? <div class="page1">&#9664;&#9664;</div>
              : <div class="page1"><a href="/posts/">&#9664;&#9664;</a></div>
            }
            {page.url.prev
              ? <div class="pageP"><a href={page.url.prev}>&#9664;</a></div>
              : <div class="pageP">&#9664;</div>
            }
            {page.url.next
              ? <div class="pageN"><a href={page.url.next}>&#9654;</a></div>
              : <div class="pageN">&#9654;</div>
            }
            {page.url.next == null
              ? <div class="pageL">&#9654;&#9654;</div>
              : <div class="pageL"><a href=`/posts/${page.lastPage}/`>&#9654;&#9654;</a></div>
            }
          </div>
        </div>
      </main>
    <Footer />
  </body>
</html>

